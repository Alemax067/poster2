<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialSphere 海报导出 - PPI可调版</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'tech-bg': '#f8fafc',
                        'tech-dark': '#1e293b',
                    },
                    fontFamily: {
                        sans: ['Noto Sans SC', 'Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&display=swap');
        
        body {
            background-color: #1e293b; 
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 40px;
            font-family: 'Noto Sans SC', sans-serif;
        }

        /* === 控制面板样式 === */
        #control-panel {
            margin-bottom: 30px;
            z-index: 100;
            display: flex;
            gap: 12px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 60px;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }

        /* PPI 选择下拉框 */
        #ppi-select {
            background: #0f172a;
            color: white;
            border: 1px solid #334155;
            padding: 8px 16px;
            border-radius: 40px;
            outline: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        /* 下载按钮 */
        #btn-download {
            background: linear-gradient(90deg, #0284c7, #4f46e5);
            color: white;
            border: none;
            padding: 10px 24px;
            font-size: 15px;
            font-weight: bold;
            border-radius: 40px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
            transition: transform 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        #btn-download:hover { transform: translateY(-2px); }
        #btn-download:disabled { opacity: 0.7; cursor: wait; background: #475569; }

        /* === 海报容器 === */
        #poster {
            width: 900px;
            height: 1200px;
            background-color: #f8fafc;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 100px rgba(0,0,0,0.5);
            transform-origin: top center;
            flex-shrink: 0; 
        }
        
        @media (max-width: 980px) { #poster { transform: scale(0.8); margin-bottom: -240px; } }
        @media (max-width: 768px) { #poster { transform: scale(0.5); margin-bottom: -600px; } }

        .grid-bg {
            background-size: 50px 50px;
            background-image: 
                linear-gradient(to right, rgba(99, 102, 241, 0.05) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(99, 102, 241, 0.05) 1px, transparent 1px);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
        }

        /* 导出模式：去毛玻璃，改实底 */
        .snapshot-mode .glass-panel {
            background: rgba(255, 255, 255, 0.96) !important; 
            backdrop-filter: none !important;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08) !important;
        }
        
        .snapshot-mode #poster {
            text-rendering: geometricPrecision; 
            -webkit-font-smoothing: antialiased;
        }

        .gradient-text {
            background: linear-gradient(135deg, #0284c7 0%, #4f46e5 50%, #9333ea 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            z-index: 0;
            opacity: 0.6;
        }
    </style>
</head>
<body>

    <div id="control-panel">
        <select id="ppi-select">
            <option value="72">72 PPI (屏幕预览)</option>
            <option value="150">150 PPI (普通打印)</option>
            <option value="300" selected>300 PPI (高清印刷)</option>
            <option value="600">600 PPI (超清印刷)</option>
        </select>

        <button id="btn-download">
            <i class="fas fa-download"></i> 导出图片
        </button>
    </div>

    <div id="poster" class="grid-bg flex flex-col justify-between p-10 text-slate-800">
        
        <div class="orb w-[500px] h-[500px] bg-blue-300 top-[-100px] left-[-100px] mix-blend-multiply"></div>
        <div class="orb w-[500px] h-[500px] bg-purple-300 top-[-100px] right-[-100px] mix-blend-multiply"></div>
        <div class="orb w-[600px] h-[600px] bg-cyan-100 bottom-[-100px] left-[100px] mix-blend-multiply opacity-40"></div>

        <header class="relative z-10 text-center mb-6">
            <div class="flex justify-between items-start">
                <div class="flex gap-2">
                    <span class="bg-white/80 px-3 py-1 rounded-lg text-xs font-bold text-blue-700 border border-blue-100 shadow-sm">
                        2025 AI应用场景创新挑战赛
                    </span>
                </div>
                <div class="flex gap-2 text-xs font-medium text-slate-500">
                    <span class="bg-white/50 px-2 py-1 rounded border border-slate-200"><i class="fas fa-university mr-1"></i>高校种子组</span>
                    <span class="bg-white/50 px-2 py-1 rounded border border-slate-200"><i class="fas fa-map-marker-alt mr-1"></i>深圳</span>
                </div>
            </div>

            <div class="mt-4">
                <h1 class="text-7xl font-black tracking-tight text-slate-900 leading-none mb-2">
                    Social<span class="gradient-text">Sphere</span>
                </h1>
                <h2 class="text-3xl font-bold text-slate-600 tracking-wide">
                    基于多智能体的社交网络模拟器
                </h2>
                <div class="w-24 h-1.5 bg-gradient-to-r from-blue-500 to-purple-600 mx-auto mt-6 rounded-full"></div>
                <p class="mt-4 text-slate-500 text-lg italic">
                    “场景驱动 · 数智强国” —— 连接商业假设与市场流量的全新推演沙盘
                </p>
            </div>
        </header>

        <main class="flex-1 grid grid-cols-12 gap-6 relative z-10 min-h-0">
            
            <div class="col-span-5 flex flex-col gap-4 h-full">
                <div class="flex items-center mb-1">
                    <div class="w-1 h-6 bg-cyan-500 mr-3 rounded"></div>
                    <h3 class="text-xl font-bold text-slate-800">技术硬核亮点</h3>
                </div>

                <div class="glass-panel p-5 rounded-2xl flex-1 flex flex-col justify-center border-l-4 border-l-cyan-500">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="text-xl font-bold text-slate-800">用户仿真引擎</h4>
                        <i class="fas fa-brain text-3xl text-cyan-200"></i>
                    </div>
                    <p class="text-xs text-slate-400 font-bold uppercase tracking-wide mb-3">Multi-modal Cognitive Agent</p>
                    <ul class="space-y-3 text-sm text-slate-700 font-medium">
                        <li class="flex items-center"><i class="fas fa-check-circle text-cyan-500 mr-2"></i>行为精度 <strong class="ml-1 text-cyan-700">95%</strong></li>
                        <li class="flex items-center"><i class="fas fa-check-circle text-cyan-500 mr-2"></i>演化耗时 <strong class="ml-1 text-cyan-700">↓ 70%</strong></li>
                        <li class="flex items-center"><i class="fas fa-check-circle text-cyan-500 mr-2"></i>思维链认知自演化</li>
                    </ul>
                </div>

                <div class="glass-panel p-5 rounded-2xl flex-1 flex flex-col justify-center border-l-4 border-l-blue-500">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="text-xl font-bold text-slate-800">社交交互引擎</h4>
                        <i class="fas fa-project-diagram text-3xl text-blue-200"></i>
                    </div>
                    <p class="text-xs text-slate-400 font-bold uppercase tracking-wide mb-3">Group Interaction</p>
                    <ul class="space-y-3 text-sm text-slate-700 font-medium">
                        <li class="flex items-center"><i class="fas fa-check-circle text-blue-500 mr-2"></i>模拟规模 <strong class="ml-1 text-blue-700">千万级</strong></li>
                        <li class="flex items-center"><i class="fas fa-check-circle text-blue-500 mr-2"></i>复杂度 <strong class="ml-1 text-blue-700">十亿级</strong></li>
                        <li class="flex items-center"><i class="fas fa-check-circle text-blue-500 mr-2"></i>动态拓扑更新</li>
                    </ul>
                </div>

                <div class="glass-panel p-5 rounded-2xl flex-1 flex flex-col justify-center border-l-4 border-l-purple-500">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="text-xl font-bold text-slate-800">流量推演引擎</h4>
                        <i class="fas fa-wave-square text-3xl text-purple-200"></i>
                    </div>
                    <p class="text-xs text-slate-400 font-bold uppercase tracking-wide mb-3">Traffic Propagation</p>
                    <ul class="space-y-3 text-sm text-slate-700 font-medium">
                        <li class="flex items-center"><i class="fas fa-check-circle text-purple-500 mr-2"></i>数据吻合度 <strong class="ml-1 text-purple-700">>80%</strong></li>
                        <li class="flex items-center"><i class="fas fa-check-circle text-purple-500 mr-2"></i>流量对齐系数 <strong class="ml-1 text-purple-700">>0.8</strong></li>
                        <li class="flex items-center"><i class="fas fa-check-circle text-purple-500 mr-2"></i>虚实联动智能推演</li>
                    </ul>
                </div>
            </div>

            <div class="col-span-7 flex flex-col gap-6">

                <div class="flex-1 flex flex-col">
                     <div class="flex items-center mb-4">
                        <div class="w-1 h-6 bg-amber-500 mr-3 rounded"></div>
                        <h3 class="text-xl font-bold text-slate-800">顶尖科研团队</h3>
                    </div>
                    
                    <div class="glass-panel p-6 rounded-2xl flex-1 border-t-4 border-t-amber-400 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-5 pointer-events-none">
                            <i class="fas fa-users text-9xl"></i>
                        </div>

                        <div class="relative z-10">
                            <h4 class="text-xl font-bold mb-3 text-transparent bg-clip-text bg-gradient-to-r from-amber-600 to-orange-600">
                                国家重点实验室硕博团队
                            </h4>
                            <p class="text-slate-600 text-sm mb-5 leading-relaxed">
                                依托三项国家级大奖，建立了从底层计算、数据感知到传播认知的完整技术闭环。
                            </p>

                            <div class="grid grid-cols-2 gap-6">
                                <div class="space-y-3">
                                    <div class="bg-white/60 p-3 rounded-lg border border-slate-200">
                                        <div class="text-[10px] text-slate-400 uppercase font-bold">首席科学家</div>
                                        <div class="flex items-baseline gap-2">
                                            <span class="font-bold text-slate-800 text-lg">张勇东</span>
                                            <span class="text-xs text-amber-600 font-bold bg-amber-50 px-1 rounded">IEEE Fellow</span>
                                        </div>
                                    </div>
                                    <div class="bg-white/60 p-3 rounded-lg border border-slate-200">
                                        <div class="text-[10px] text-slate-400 uppercase font-bold">指导老师</div>
                                        <div class="flex items-baseline gap-2">
                                            <span class="font-bold text-slate-800 text-lg">刘武</span>
                                            <span class="text-xs text-amber-600 font-bold bg-amber-50 px-1 rounded">MIT TR35</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="bg-white/60 p-3 rounded-lg border border-slate-200 h-full">
                                        <div class="text-[10px] text-slate-400 uppercase font-bold mb-2">核心成员</div>
                                        <ul class="space-y-2">
                                            <li class="flex items-center">
                                                <span class="w-6 h-6 rounded-full bg-slate-800 text-white flex items-center justify-center text-xs mr-2">S</span>
                                                <span class="text-sm font-bold text-slate-800">孙艳辉</span>
                                                <span class="ml-auto text-xs bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded">答辩人</span>
                                            </li>
                                            <li class="flex items-center text-sm text-slate-600">
                                                <span class="w-6 h-6 rounded-full bg-slate-200 text-slate-500 flex items-center justify-center text-xs mr-2">L</span>
                                                刘展鹏
                                            </li>
                                            <li class="flex items-center text-sm text-slate-600">
                                                <span class="w-6 h-6 rounded-full bg-slate-200 text-slate-500 flex items-center justify-center text-xs mr-2">Z</span>
                                                周绚
                                            </li>
                                            <li class="text-xs text-slate-400 mt-2 pt-2 border-t border-slate-200">
                                                + 10名博士 / 20名硕士
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="flex items-center mb-4">
                        <div class="w-1 h-6 bg-pink-500 mr-3 rounded"></div>
                        <h3 class="text-xl font-bold text-slate-800">商业落地与应用</h3>
                    </div>
                    
                    <div class="flex flex-col gap-4">
                        <div class="bg-white/80 rounded-xl p-4 shadow-sm border border-slate-100 flex items-center gap-4">
                            <div class="w-16 h-16 rounded-lg bg-red-50 flex items-center justify-center flex-shrink-0 text-red-500 text-3xl">
                                <i class="fab fa-weibo"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-center mb-1">
                                    <h4 class="font-bold text-lg">微博 · 热度预测</h4>
                                    <span class="text-red-600 font-black text-xl">提速 83.2%</span>
                                </div>
                                <p class="text-sm text-slate-500">“未发先火” —— 精准捕捉互动趋势，优化内容分发策略。</p>
                            </div>
                        </div>

                        <div class="bg-white/80 rounded-xl p-4 shadow-sm border border-slate-100 flex items-center gap-4">
                            <div class="w-16 h-16 rounded-lg bg-blue-50 flex items-center justify-center flex-shrink-0 text-blue-500 text-3xl">
                                <i class="fas fa-newspaper"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-center mb-1">
                                    <h4 class="font-bold text-lg">人民网 · 运营推广</h4>
                                    <span class="text-blue-600 font-black text-xl">一致性 ≥35%</span>
                                </div>
                                <p class="text-sm text-slate-500">长周期传播复现与反事实推演，辅助政策宣传制定。</p>
                            </div>
                        </div>

                        <div class="bg-white/80 rounded-xl p-4 shadow-sm border border-slate-100 flex items-center gap-4">
                            <div class="w-16 h-16 rounded-lg bg-red-50 flex items-center justify-center flex-shrink-0 text-red-700 text-3xl">
                                <i class="fas fa-shopping-bag"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-center mb-1">
                                    <h4 class="font-bold text-lg">京东 · 市场测试</h4>
                                    <span class="text-green-600 font-black text-xl">降本 5亿+</span>
                                </div>
                                <p class="text-sm text-slate-500">接入2000万+真实用户数据，进行新品市场投放仿真。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="mt-8 pt-6 border-t border-slate-300 relative z-10">
            <div class="grid grid-cols-4 gap-8 mb-4 text-center divide-x divide-slate-200">
                <div>
                    <div class="text-4xl font-black text-slate-800 mb-1">50亿+</div>
                    <div class="text-xs text-slate-500 uppercase font-semibold tracking-widest">全球社交媒体用户</div>
                </div>
                <div>
                     <div class="text-4xl font-black text-slate-800 mb-1">1000万</div>
                    <div class="text-xs text-slate-500 uppercase font-semibold tracking-widest">融资计划 (10%)</div>
                </div>
                <div>
                     <div class="text-4xl font-black text-slate-800 mb-1">27.2%</div>
                    <div class="text-xs text-slate-500 uppercase font-semibold tracking-widest">五年平均利润率</div>
                </div>
                <div>
                     <div class="text-4xl font-black text-slate-800 mb-1">1.89亿</div>
                    <div class="text-xs text-slate-500 uppercase font-semibold tracking-widest">五年预计营收</div>
                </div>
            </div>
            
            <div class="flex justify-between items-center mt-6 text-slate-400 text-xs font-mono border-t border-slate-200 pt-4">
                <span>&copy; 2026 SocialSphere Project Team.</span>
                <span>DESIGNED FOR 3RD AI CHALLENGE</span>
            </div>
        </footer>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.js"></script>

    <script>
        // === 1. 字体加载辅助函数 ===
        async function fetchFontAndReturnCSS(fontUrl, fontFamily, fontWeight) {
            console.log(`正在下载字体: ${fontUrl}`);
            try {
                const response = await fetch(fontUrl);
                const blob = await response.blob();
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        const css = `
                            @font-face {
                                font-family: '${fontFamily}';
                                font-style: normal;
                                font-weight: ${fontWeight};
                                src: url(${reader.result}) format('woff2');
                            }
                        `;
                        resolve(css);
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(blob);
                });
            } catch (error) {
                console.error("字体下载失败", error);
                throw error;
            }
        }

        // === 2. 核心导出逻辑 ===
        document.getElementById('btn-download').addEventListener('click', async function() {
            const btn = this;
            const originalText = btn.innerHTML;
            const poster = document.getElementById('poster');
            const ppiSelect = document.getElementById('ppi-select');
            
            // 获取用户选择的 PPI
            const targetPPI = parseInt(ppiSelect.value);
            // 计算缩放比：目标PPI / 浏览器默认PPI (96)
            // 例：600 / 96 = 6.25
            const pixelRatio = targetPPI / 96;

            console.log(`目标 PPI: ${targetPPI}, 缩放倍率: ${pixelRatio}`);

            // 锁定按钮状态
            btn.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i> 正在处理 (${targetPPI} PPI)...`;
            btn.disabled = true;

            try {
                // A. 加载字体 (每次导出都确保加载，防止首次失败)
                if (!window.fontsLoaded) {
                    btn.innerHTML = `<i class="fas fa-font"></i> 正在加载字库...`;
                    const fontCssSolid = await fetchFontAndReturnCSS(
                        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/webfonts/fa-solid-900.woff2',
                        'Font Awesome 6 Free', 900
                    );
                    const fontCssBrands = await fetchFontAndReturnCSS(
                        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/webfonts/fa-brands-400.woff2',
                        'Font Awesome 6 Brands', 400
                    );
                    const styleEl = document.createElement('style');
                    styleEl.innerHTML = fontCssSolid + "\n" + fontCssBrands;
                    document.head.appendChild(styleEl);
                    window.fontsLoaded = true; // 标记已加载
                }

                // B. 开始渲染
                btn.innerHTML = `<i class="fas fa-image"></i> 正在渲染像素...`;
                document.body.classList.add('snapshot-mode');
                await new Promise(r => setTimeout(r, 500)); // 等待样式重绘

                const dataUrl = await htmlToImage.toPng(poster, { 
                    pixelRatio: pixelRatio, // 动态使用计算后的缩放比
                    cacheBust: true,
                });

                // C. 下载
                const link = document.createElement('a');
                link.download = `SocialSphere-${targetPPI}PPI.png`;
                link.href = dataUrl;
                link.click();

            } catch (error) {
                console.error('导出失败:', error);
                alert(`导出出错 (PPI: ${targetPPI})。如果选了 600PPI，可能是内存不足，请尝试降低到 300PPI。`);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
                document.body.classList.remove('snapshot-mode');
            }
        });
    </script>
</body>
</html>